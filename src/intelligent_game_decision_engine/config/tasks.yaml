---
process_dynamic_game_state_input:
  description: |
    **GAME STATE PROCESSOR WITH MUSIC GENERATION** - Processes incoming game state
    data and triggers music generation via the appropriate tool.

    **DEFAULT: Always use the Music Generator tool** (music_generator)
    to generate music. When calling it:
    - Derive `game_state` from the incoming {game_state} data — analyze the mood,
      energy level, and scene context to produce a concise music style phrase
      (e.g. "tense EDM", "calm ambient", "celebratory orchestral", "mysterious lo-fi").

    **FALLBACK: GameActionExecutorTool** — Only use if explicitly instructed. This calls
    the play_music API at `https://snowflake-one.vercel.app/api/play_music` with
    parameter `tone` ("high", "medium", "low", "verylow").

    **Energy-Level Reference (for deriving music style from game state):**
    - **High energy** (0.8+): Major events, victories, celebrations — use exciting/intense music styles
    - **Medium energy** (0.5-0.79): Standard interactions, moderate scenes — use balanced/upbeat styles
    - **Low energy** (0.3-0.49): Calm scenes, quiet periods — use ambient/relaxed styles
    - **Very low energy** (0.0-0.29): Minimal activity, deep focus — use subtle/minimal styles

    **Decision Guidelines:**
    1. **Energy Level is PRIMARY factor** for determining music mood
    2. **Scene Mood modifies style** — celebratory bumps intensity up, tense/negative shifts tone
    3. **Social Activity impacts choice** — high social favors energetic styles, low social favors calm

    Input: {game_state} - Game state structure (partial or complete)

  expected_output: |
    **MANDATORY: You MUST actually execute the Music Generator tool
    (music_generator) and include the real response.**

    ```json
    {
      "input_analysis": {
        "processed_fields": ["list of fields parsed from game_state"],
        "data_completeness": "percentage",
        "input_quality": "sufficient/insufficient/poor"
      },

      "reasoning_process": {
        "step_1_data_evaluation": "Analyzed game state — summary of key data points",
        "step_2_energy_assessment": "Energy level and its implications for music style",
        "step_3_mood_analysis": "Scene mood and how it shapes the music style phrase",
        "step_4_final_music_style": "Derived music style phrase, e.g. 'tense EDM'",
        "confidence_score": "0.80"
      },

      "tool_invocation": {
        "tool_used": "Music Generator (music_generator)",
        "inputs_sent": {
          "game_state": "derived music style phrase"
        },
        "tool_response": "REAL_RESPONSE_FROM_MUSIC_GENERATOR"
      },

      "execution_status": "success_or_failure_based_on_actual_tool_response"
    }
    ```

    **CRITICAL**: The "tool_response" field must contain the actual response
    from calling the Music Generator tool — do not fabricate this data.

  agent: intelligent_game_decision_agent
